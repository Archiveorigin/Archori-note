# å®¹å™¨æŠ€æœ¯

# Podman å®¹å™¨ç®¡ç†

**é…ç½®æ–‡ä»¶**

`/etc/containers/registries.conf`

**æŸ¥çœ‹æœ¬åœ°é•œåƒ**

`podman images`

```bash
[root@CitProbe docker] podman images
Emulate Docker CLI using podman. Create /etc/containers/nodocker to quiet msg.
REPOSITORY             TAG         IMAGE ID      CREATED      SIZE
quay.io/podman/hello   latest      5dd467fce50b  7 weeks ago  787 kB
quay.io/centos/centos  latest      300e315adb2f  3 years ago  217 MB
```

**æŸ¥çœ‹å­˜æ´»çš„å®¹å™¨**

`podman ps`

**æŸ¥çœ‹æ‰€æœ‰å®¹å™¨**

`podman ps -a`

**åˆ é™¤åœæ­¢çš„å®¹å™¨**

`podman container rm å®¹å™¨`

**åˆ é™¤é•œåƒ**

`podman image rm é•œåƒ`

<aside>
ğŸ’¡ å¦‚æœæ‹‰å–é•œåƒçš„æ—¶å€™æ²¡æœ‰æŒ‡å®štag é»˜è®¤ä¸ºlatest

</aside>

**ä¿å­˜é•œåƒ**

`podman save -o æŒ‡å®šåç§° é•œåƒå`

```bash
[root@CitProbe ~] **podman save -o Centtt.tar ubuntu:latest**
Copying blob 9f54eef41275 done
Copying config ba6acccedd done
Writing manifest to image destination
Storing signatures
[root@CitProbe ~] ls
aaa              **Centtt.tar**
```

**åŠ è½½é•œåƒ**

`podman load -i é•œåƒåŒ…åç§°`

```bash
[root@CitProbe ~] podman load -i Centtt.tar
Getting image source signatures
Copying blob 9f54eef41275 skipped: already exists
Copying config ba6acccedd done
Writing manifest to image destination
Storing signatures
Loaded image: docker.io/library/ubuntu:latest
```

## é…ç½®é•œåƒåŠ é€Ÿ

```bash
unqualified-search-registries = ["docker.io"]
[[registry]]
prefix = "docker.io"
location = "5ufvppm7.mirror.aliyuncs.com"
```

**é•œåƒæœç´¢**

`podman search é•œåƒå`

```bash
[root@CitProbe ~] **podman search nginx**
NAME                                        DESCRIPTION
docker.io/library/nginx                     Official build of Nginx.
docker.io/library/unit                      Official build of NGINX Unit: Universal Web...
docker.io/nginx/nginx-ingress               NGINX and  NGINX Plus Ingress Controllers fo...
docker.io/nginxinc/nginx-unprivileged       Unprivileged NGINX Dockerfiles
docker.io/nginx/nginx-prometheus-exporter   NGINX Prometheus Exporter for NGINX and NGIN...
docker.io/nginx/unit                        This repository is retired, use the Docker o...
docker.io/nginx/nginx-ingress-operator      NGINX Ingress Operator for NGINX and NGINX P...
docker.io/nginxinc/nginx-s3-gateway         Authenticating and caching gateway based on...
docker.io/nginx/nginx-quic-qns              NGINX QUIC interop
docker.io/nginxinc/amplify-agent            NGINX Amplify Agent docker repository
docker.io/nginxinc/ingress-demo             Ingress Demo
docker.io/nginxproxy/nginx-proxy            Automated nginx proxy for Docker containers...
docker.io/nginx/unit-preview                Unit preview features
docker.io/bitnami/nginx                     Bitnami container image for NGINX
docker.io/nginxproxy/acme-companion         Automated ACME SSL certificate generation fo...
docker.io/ubuntu/nginx                      Nginx, a high-performance reverse proxy & we...
docker.io/nginxproxy/docker-gen             Generate files from docker container meta-da...
docker.io/kasmweb/nginx                     An Nginx image based off nginx:alpine and in...
docker.io/nginxinc/mra-fakes3
docker.io/bitnami/nginx-ingress-controller  Bitnami container image for NGINX Ingress Co...
docker.io/bitnami/nginx-exporter            Bitnami container image for NGINX Exporter
docker.io/rancher/nginx
docker.io/nginxinc/ngx-rust-tool
docker.io/nginxinc/mra_python_base
```

### å®¹å™¨ç®¡ç†

**è¿è¡Œå®¹å™¨**

`podman run å‚æ•°`

```bash
-d åœ¨åå°

--name ä¸ºå®¹å™¨æŒ‡å®šåç§°
		podman run -d nginx --name Mynginx
		
-p å°†å®¹å™¨å†…éƒ¨ç«¯å£æ˜ å°„åˆ°ä¸»æœºç«¯å£
		podman run -d -p 8080:80 nginx
		
-v å°†ä¸»æœºç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…ç›®å½•
		podman run -d -v /host/path:/container/path nginx
		
-e è®¾ç½®ç¯å¢ƒå˜é‡
		podman run -d -e MYVAR=myvalue nginx
		
-it ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ å¹¶åˆ†é…ä¸€ä¸ªä¼ªtty
		podman run -it alpine /bin/sh
		
--rm å®¹å™¨åœæ­¢åè‡ªåŠ¨åˆ é™¤å®¹å™¨
		podman run --rm -it alpine /bin/sh
		
--network æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„ç½‘ç»œåç§°
		podman run --network host -d nginx
		
--user ä»¥æŒ‡å®šç”¨æˆ·è¿è¡Œå®¹å™¨
		podman run -d --user 1000:1000 nginx
```

```bash
[root@CitProbe ~] podman run -d --name mycentos ubuntu
0b4989cc37df899c1625e927d675c0a3002b2cc38400227e74a80531fb3166c1
```

**é‡å¯å®¹å™¨**

`podman restart å®¹å™¨å`

```bash
[root@CitProbe ~] podman restart mycentos
mycentos
```

**åœæ­¢å®¹å™¨**

`podman container stop å®¹å™¨å`

```bash
[root@CitProbe ~] podman stop mycentos
mycentos
```

**åˆ é™¤å®¹å™¨**

`podman rm -f å®¹å™¨å`

```bash
[root@CitProbe ~] podman rm mycentos
mycentos
```

**è¿›å…¥å®¹å™¨**

`podman exec å‚æ•°`

```bash
-i ä¿æŒæ ‡å‡†è¾“å…¥ä¸ºæ‰“å¼€çŠ¶æ€
		podman exec -i mycontainer /bin/bash
		
-t åˆ†é…ä¸€ä¸ªä¼ªtty
		podman exec -t mycontainer /bin/bash
		
-it ç›¸å½“äº -i -t å¸¸ç”¨äºæ‰“å¼€äº¤äº’å¼shell
		podman exec -it mycontainer /bin/bash
```

```bash
[root@CitProbe ~] **podman exec -it web1 /bin/bash**
root@e400dd58323e:/usr/local/apache2# ls
bin  build  cgi-bin  conf  error  htdocs  icons  include  logs  modules
```

**æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯**

`podman inspect å®¹å™¨å`

## Podman ç½‘ç»œç®¡ç†

**æŸ¥çœ‹ç½‘ç»œ**

`podman network ls`

```bash
[root@CitProbe ~] podman network ls
NETWORK ID    NAME        DRIVER
2f259bab93aa  podman      bridge
```

**åˆ›å»ºç½‘ç»œ**

`podman network create ç½‘ç»œåç§°`

```bash
[root@CitProbe ~] podman network create Network-1
Network-1
[root@CitProbe ~] podman network ls
NETWORK ID    NAME        DRIVER
3edcd698e75d  Network-1   bridge
2f259bab93aa  podman      bridge
```

**åˆ é™¤ç½‘ç»œ**

`podman network rm -f ç½‘ç»œåç§°`

```bash
[root@CitProbe ~] podman network rm Network-1
Network-1
[root@CitProbe ~] podman network ls
NETWORK ID    NAME        DRIVER
2f259bab93aa  podman      bridge
```

## Podman æŒä¹…åŒ–å­˜å‚¨

<aside>
ğŸ’¡ åœ¨Podmanä¸­å®ç°æŒä¹…åŒ–å­˜å‚¨ å¯ä»¥é€šè¿‡æŒ‚è½½å·(Volumes)æˆ–å°†ä¸»æœºç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…æ¥å®ç° è¿™å…è®¸å®¹å™¨é‡å¯æˆ–è€…è¢«åˆ é™¤å æ•°æ®ä»ç„¶å¯ä»¥ä¿å­˜åœ¨ä¸»æœºä¸Š

</aside>

**åˆ›å»ºå·**

`podman volume create å·å`

```bash
[root@CitProbe ~] podman volume create a1
a1
```

**æŸ¥çœ‹å·**

`podman volume ls`

```bash
[root@CitProbe ~] podman volume ls
DRIVER      VOLUME NAME
local       a1
```

**åˆ›å»ºæ—¶æŒ‚è½½å·**

`podman run -d --name åå­— -v ä¸»æœºç›®å½•æˆ–å·å:å®¹å™¨å†…è·¯å¾„ é€‰é¡¹ é•œåƒå`

```bash
[root@CitProbe ~] podman run -it --name centos -v a1:/web centos /bin/bash
[root@6081d73d4902 /]# df -Th
Filesystem            Type      Size  Used Avail Use% Mounted on
overlay               overlay    17G  5.8G   12G  34% /
tmpfs                 tmpfs      64M     0   64M   0% /dev
/dev/mapper/rhel-root xfs        17G  5.8G   12G  34% /web
shm                   tmpfs      63M     0   63M   0% /dev/shm
tmpfs                 tmpfs     727M   10M  718M   2% /etc/hosts
devtmpfs              devtmpfs  4.0M     0  4.0M   0% /proc/keys
```

## è§£å†³SELinuxå®‰å…¨ä¸Šä¸‹æ–‡é—®é¢˜

**é—®é¢˜è§£å†³**

```bash
[root@CitProbe web] **podman run -d --name web2 -p 22223:80 -v /web:/usr/local/apache2/htdocs:Z httpd**
0d62a1150910dd773520eb5c28f1e18e2a47e037ab4743cb3f06d6a4fc816141
```

## systemd æ¥ç®¡ Podman â€”  å®¹å™¨è‡ªå¯åŠ¨

### ç”Ÿæˆsystemdé…ç½®æ–‡ä»¶

`podman generate systemd å®¹å™¨å`

```bash
[root@CitProbe web] podman generate systemd web1
# container-61abd90a23360a6e31a31a4e6f055cd0c76a35cb7fb85f20f6c16c6e8b16969b.service
# autogenerated by Podman 4.4.1
# Thu Jul 18 18:47:54 CST 2024

[Unit]
Description=Podman container-61abd90a23360a6e31a31a4e6f055cd0c76a35cb7fb85f20f6c16c6e8b16969b.service
Documentation=man:podman-generate-systemd(1)
Wants=network-online.target
After=network-online.target
RequiresMountsFor=/run/containers/storage

[Service]
Environment=PODMAN_SYSTEMD_UNIT=%n
Restart=on-failure
TimeoutStopSec=70
ExecStart=/usr/bin/podman start 61abd90a23360a6e31a31a4e6f055cd0c76a35cb7fb85f20f6c16c6e8b16969b
ExecStop=/usr/bin/podman stop  \
        -t 10 61abd90a23360a6e31a31a4e6f055cd0c76a35cb7fb85f20f6c16c6e8b16969b
ExecStopPost=/usr/bin/podman stop  \
        -t 10 61abd90a23360a6e31a31a4e6f055cd0c76a35cb7fb85f20f6c16c6e8b16969b
PIDFile=/run/containers/storage/overlay-containers/61abd90a23360a6e31a31a4e6f055cd0c76a35cb7fb85f20f6c16c6e8b16969b/userdata/conmon.pid
Type=forking

[Install]
WantedBy=default.target
```

**ç›´æ¥ç”Ÿæˆé…ç½®æ–‡ä»¶**

`podman generate systemd --files --name å®¹å™¨å`

```bash
--name ä½¿ç”¨å®¹å™¨åå­—ä»£æ›¿id
--files ç”ŸæˆæœåŠ¡æ–‡ä»¶
--new è®¾ç½®å®¹å™¨å…³é—­åˆ é™¤ å¯åŠ¨æ—¶é‡æ–°åˆ›å»º #è€ƒè¯•è¦è€ƒ
```

```bash
[root@CitProbe web] podman generate systemd --files --name web1
/web/container-web1.service
```

**systemdæ¥ç®¡**

```bash
# å°†é…ç½®æ–‡ä»¶ç§»åŠ¨åˆ°systemdé…ç½®æ–‡ä»¶å¤„
[root@CitProbe web] **mv container-web1.service /etc/systemd/system**
# é‡æ–°æ ‡è®°SELinuxå®‰å…¨ä¸Šä¸‹æ–‡
[root@CitProbe system] **restorecon -RvF /etc/systemd/system/container-web1.service**
Relabeled /etc/systemd/system/container-web1.service from unconfined_u:object_r:container_file_t:s0:c404,c973 to system_u:object_r:systemd_unit_file_t:s0
# é‡æ–°åŠ è½½æ‰€æœ‰systemdæœåŠ¡
[root@CitProbe system] **systemctl daemon-reload**
# è®¾ç½®æŒ‡å®šå®¹å™¨å¼€æœºè‡ªå¯åŠ¨
[root@CitProbe system] **systemctl enable container-web1.service**
Created symlink /etc/systemd/system/default.target.wants/container-web1.service â†’ /etc/systemd/system/container-web1.service.
# å°†ä¸»æœºé‡å¯
[root@CitProbe system] **reboot**
# æ£€æŸ¥å®¹å™¨æ˜¯å¦è‡ªå¯åŠ¨
[root@CitProbe ~] **podman ps**
CONTAINER ID  IMAGE                           COMMAND           CREATED         STATUS        PORTS                  NAMES
61abd90a2336  docker.io/library/httpd:latest  httpd-foreground  35 minutes ago  Up 2 minutes  0.0.0.0:22222->80/tcp  web1
```

## éæ ¹ç”¨æˆ·ä½¿ç”¨Podman

<aside>
ğŸ’¡ å¦‚æœéœ€è¦ä½¿ç”¨éæ ¹ç”¨æˆ·æ“ä½œPodman é‚£ä¹ˆç”¨æˆ·å¿…é¡»sshç™»å½•æˆ–è€…ç»ˆç«¯ç™»å½•

</aside>

<aside>
ğŸ’¡ rootæ‹¥æœ‰çš„images æ™®é€šç”¨æˆ·æ˜¯çœ‹ä¸åˆ°çš„

</aside>

### éæ ¹ç”¨æˆ·ä½¿ç”¨systemdæ¥ç®¡å®¹å™¨

```bash
# åˆ›å»ºæ–‡ä»¶å¤¹
[xym@CitProbe ~] **mkdir ~/.config/systemd/user -p**
# ä¸ºå®¹å™¨åˆ¶ä½œsystemdé…ç½®æ–‡ä»¶
[xym@CitProbe ~] **podman generate systemd --new --files --name web1**
# å°†é…ç½®æ–‡ä»¶ç§»åŠ¨åˆ°ä¸ªäººç”¨æˆ·systemdæ–‡ä»¶å¤¹ä¸­
[xym@CitProbe ~] **mv container-web1.service ~/.config/systemd/user/**
# åˆ·æ–°SELinuxå®‰å…¨ä¸Šä¸‹æ–‡
[xym@CitProbe ~] **restorecon -RvF ~/.config/systemd/user/container-web1.service**
# å°†å½“å‰ç”¨æˆ·è®¾ä¸ºå…è®¸é€šè¿‡systemdç®¡ç†é…ç½®æ–‡ä»¶
[xym@CitProbe ~] **loginctl enable-linger**
# å°†ç”¨æˆ·è‡ªå®šä¹‰systemdåŠ å…¥
[xym@CitProbe ~] **systemctl --user daemon-reload**
# åŠ å…¥å¼€æœºè‡ªå¯åŠ¨
[xym@CitProbe ~] **systemctl --user enable container-web1.service --now**
# æ£€æŸ¥çŠ¶æ€
[xym@CitProbe ~] **systemctl --user status container-web1.service**
â— container-web1.service - Podman container-web1.service
     Loaded: loaded (/home/xym/.config/systemd/user/container-web1.service; enabled; pre>
     Active: active (running) since Thu 2024-07-18 23:19:20 CST; 30s ago
       Docs: man:podman-generate-systemd(1)
   Main PID: 7347 (conmon)
      Tasks: 16 (limit: 22862)
     Memory: 13.1M
        CPU: 218ms
     CGroup: /user.slice/user-1003.slice/user@1003.service/app.slice/container-web1.serv>
             â”œâ”€7329 /usr/bin/slirp4netns --disable-host-loopback --mtu=65520 --enable-sa>
             â”œâ”€7331 rootlessport
             â”œâ”€7337 rootlessport-child
             â””â”€7347 /usr/bin/conmon --api-version 1 -c f5229cb6a5b88f796dda4bfefaf5a3c5f>
```