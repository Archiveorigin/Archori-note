# é€šç”¨æ–‡ä»¶ç³»ç»Ÿ

## é€šç”¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

### æŸ¥çœ‹å—è®¾å¤‡

`/dev/`

```bash
[root@CitProbe dev] ls -l | grep nvme
crw-------. 1 root root    240,   0 Jul 13 12:50 nvme0
brw-rw----. 1 root disk    259,   0 Jul 13 12:50 nvme0n1
brw-rw----. 1 root disk    259,   1 Jul 13 12:50 nvme0n1p1
brw-rw----. 1 root disk    259,   2 Jul 13 12:50 nvme0n1p2

b block è¡¨ç¤ºå—è®¾å¤‡
nvme0 è¡¨ç¤ºè¯†åˆ«åˆ°nvmeè®¾å¤‡é©±åŠ¨å™¨
nmve0n1 è¡¨ç¤ºnvmeè®¾å¤‡çš„ç¬¬ä¸€å—ç¡¬ç›˜
nmve0n1p1 è¡¨ç¤ºç¬¬ä¸€å—ç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒº
```

**åœ¨Linuxä¸­ä¸åŒçš„å—æ ‡è®°**

SATAç¡¬ç›˜ /dev/sd* a,b,câ€¦.

SCSIç¡¬ç›˜ /dev/sd* a,b,câ€¦.

IDEç¡¬ç›˜ /dev/hd* a,b,câ€¦.

NVMEç¡¬ç›˜ /dev/nvme*n*  0,1,2 0,1,2 ç¬¬ä¸€ä¸ªæ˜¯æ§åˆ¶å™¨ ç¬¬äºŒä¸ªä¸ºç¡¬ç›˜åºå·

**ç¡¬ç›˜åˆ†åŒºæ ‡è®°**

å¯¹äºSATAå’ŒSCSI

ç¬¬Xå—ç¡¬ç›˜çš„ç¬¬Nä¸ªåˆ†åŒºæ˜¯ /dev/sdXN

Xè¡¨ç¤º aï¼Œbï¼Œcï¼Œdï¼Œ

Nè¡¨ç¤º1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ

### é€šè¿‡å‘½ä»¤è¡Œå¯¹å—è®¾å¤‡åˆ†åŒº

- è¿›è¡ŒMBRç±»å‹åˆ†åŒºç”¨ `fdisk` å‘½ä»¤
- è¿›è¡ŒGPTç±»å‹åˆ†åŒºç”¨ `gdisk` å‘½ä»¤
- å…¶ä»–ç±»å‹åˆ†åŒºç”¨ `part` å‘½ä»¤

**æŸ¥çœ‹åˆ†åŒºæƒ…å†µ**

`fdisk å‚æ•°` 

```bash
-l æ˜¾ç¤ºç£ç›˜åˆ†åŒºæƒ…å†µ
```

```bash
[root@CitProbe dev] **fdisk -l /dev/nvme0n2**
Disk /dev/nvme0n2: 10 GiB, 10737418240 bytes, 20971520 sectors
Disk model: VMware Virtual NVMe Disk
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
```

**æ‰‹å·¥æ“ä½œç£ç›˜**

`fdisk å—è®¾å¤‡è·¯å¾„`

```bash
# fdisk å¯¹æ–°ç£ç›˜è‡ªåŠ¨è¿›è¡ŒMBRåˆå§‹åŒ–æ“ä½œ
# fdisk ä¸ºäº¤äº’å¼å‘½ä»¤

[root@CitProbe dev] ls -l nvme0n2
brw-rw----. 1 root disk 259, 3 Jul 13 13:40 nvme0n2
[root@CitProbe dev] **fdisk nvme0n2**

Welcome to fdisk (util-linux 2.37.4).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table.
**Created a new DOS disklabel with disk identifier 0x61e35ffc. #è‡ªåŠ¨åˆå§‹åŒ–ä¸ºMBR ï¼ˆå³åˆå§‹åŒ–å‰512å­—èŠ‚ä¸»å¼•å¯¼è®°å½•ï¼‰**

Command (m for help):
```

```bash
n æ·»åŠ ä¸€ä¸ªæ–°åˆ†åŒº
  p æ·»åŠ ä¸»åˆ†åŒº
  e æ·»åŠ æ‰©å±•åˆ†åŒº
  l æ·»åŠ é€»è¾‘åˆ†åŒº
l åˆ—å‡ºå½“å‰æ”¯æŒçš„åˆ†åŒºç§ç±»
p åˆ—å‡ºå½“å‰çŠ¶æ€çš„æ‰€æœ‰åˆ†åŒº
t ä¿®æ”¹åˆ†åŒºç±»å‹ æ— å®é™…æ„ä¹‰
d åˆ é™¤ä¸€ä¸ªåˆ†åŒº
w ä¿å­˜å¹¶é€€å‡º

```

**è‡ªåŠ¨æ“ä½œç£ç›˜**

ä½¿ç”¨æ–‡æœ¬å’Œè¾“å…¥é‡å®šå‘ `<` è‡ªåŠ¨åˆ†é…ç£ç›˜

**ä½¿ç”¨gdiskæ“ä½œç£ç›˜**

`gdisk ç£ç›˜`

```bash
# gdisk å¯¹æ–°ç£ç›˜è‡ªåŠ¨è¿›è¡ŒGPTåˆå§‹åŒ–æ“ä½œ
# gdisk æ“ä½œä¸fdiskç±»ä¼¼
```

## Linuxæ–‡ä»¶ç³»ç»Ÿ

### æ ¼å¼åŒ–Linuxåˆ†åŒº

```bash
# å¯¹äºLinuxåˆ†åŒºæ¥è¯´ åªæœ‰æ ¼å¼åŒ–çš„åˆ†åŒºæ‰å¯ä»¥ä½¿ç”¨
# Linuxåˆ†åŒºæ ¼å¼åŒ–åå°±ä¼šå˜æˆæ–‡ä»¶ç³»ç»Ÿ
# æ ¼å¼åŒ–çš„è¿‡ç¨‹ç›¸å½“äºå¯¹åˆ†åŒºåšäº†ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ
# Linuxå¸¸è§çš„æ–‡ä»¶ç³»ç»Ÿæœ‰extç³»åˆ— xfsç³»åˆ— btfsç³»åˆ—
```

```bash
[root@CitProbe ~] mkfs
mkfs         mkfs.ext2    mkfs.ext4    mkfs.minix   mkfs.vfat
mkfs.cramfs  mkfs.ext3    mkfs.fat     mkfs.msdos   mkfs.xfs
```

```bash
[root@CitProbe dev] **mkfs.ext4 /dev/nvme0n2p1**
mke2fs 1.46.5 (30-Dec-2021)
Creating filesystem with 786432 4k blocks and 196608 inodes
Filesystem UUID: 30cf8aea-aaf8-4cf6-aad5-27b051fa2a3d
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912

Allocating group tables: done
Writing inode tables: done
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information: done
```

<aside>
ğŸ’¡ åˆ†åŒºçš„æ„ä¹‰åœ¨äºå°†ç¡¬ç›˜çš„è¯»å’Œå†™çš„ç²’åº¦æ”¾å¤§ è®©è¯»å†™çš„æ•ˆç‡æå‡ åœ¨æ ¼å¼åŒ–ä¹‹å æ–‡ä»¶ç³»ç»Ÿä¼šç«‹åˆ»åˆ†é…ä¸€éƒ¨åˆ†ç©ºé—´ä½œä¸ºinodeèŠ‚ç‚¹ç©ºé—´ å‰©ä½™çš„ç©ºé—´ç”¨ä½œåˆ’åˆ†block blockè¶Šå¤§ æ„å‘³ç€ç²’åº¦è¶Šå¤§ åˆ’åˆ†blockçš„æ„ä¹‰åœ¨äºä½¿æ–‡ä»¶çš„å­˜æ”¾ä¸è¯»å–éƒ½ä»¥blockè¿›è¡Œ æ›´å¤§çš„blockæ„å‘³ç€æå‡è¯»å†™æ•ˆæœè€Œç‰ºç‰²ç©ºé—´åˆ©ç”¨ç‡

</aside>

### ä¸´æ—¶æŒ‚è½½åˆ†åŒº

`mount -t æ–‡ä»¶ç³»ç»Ÿç±»å‹ åˆ†åŒºè·¯å¾„ æŒ‚è½½ç‚¹`

<aside>
ğŸ’¡ åŸç”Ÿlinuxæ–‡ä»¶ç³»ç»Ÿå¯ä»¥è¢«ç³»ç»Ÿè¯†åˆ« ä¸éœ€è¦åŠ -t

</aside>

`mount åˆ†åŒºè·¯å¾„ æŒ‚è½½ç‚¹`

<aside>
ğŸ’¡ ç±»ä¼¼ext xfsç³»åˆ—æ–‡ä»¶ç³»ç»Ÿä¸ºLinuxåŸç”Ÿæ–‡ä»¶ç³»ç»Ÿ

</aside>

```bash
[root@CitProbe dev] mount /dev/nvme0n2p1 /mount1
[root@CitProbe dev] mount /dev/nvme0n2p5 /mount2
[root@CitProbe dev] mount /dev/nvme0n2p6 /mount3
[root@CitProbe dev] df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               4.0M     0  4.0M   0% /dev
tmpfs                  1.8G     0  1.8G   0% /dev/shm
tmpfs                  728M  9.7M  718M   2% /run
/dev/mapper/rhel-root   17G  4.2G   13G  25% /
/dev/nvme0n1p1        1014M  292M  723M  29% /boot
tmpfs                  364M   52K  364M   1% /run/user/42
tmpfs                  364M   36K  364M   1% /run/user/0
/dev/nvme0n2p1         2.9G   24K  2.8G   1% /mount1
/dev/nvme0n2p5         2.0G   24K  1.8G   1% /mount2
/dev/nvme0n2p6         4.9G   24K  4.6G   1% /mount3
```

**æŸ¥çœ‹å·²æŒ‚è½½åˆ†åŒºçŠ¶æ€**

`df å‚æ•°`

```bash
-hæˆ–--human-readableï¼šä»¥å¯è¯»æ€§è¾ƒé«˜çš„æ–¹å¼æ¥æ˜¾ç¤ºä¿¡æ¯ï¼›
-Hæˆ–--siï¼šä¸-hå‚æ•°ç›¸åŒï¼Œä½†åœ¨è®¡ç®—æ—¶æ˜¯ä»¥1000 Bytesä¸ºæ¢ç®—å•ä½è€Œé1024 Bytesï¼›
-iæˆ–--inodesï¼šæ˜¾ç¤ºinodeçš„ä¿¡æ¯ï¼›
-kæˆ–--kilobytesï¼šæŒ‡å®šåŒºå—å¤§å°ä¸º1024å­—èŠ‚ï¼›
-Tæˆ–--print-typeï¼šæ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹ï¼›
```

### æŒç»­æ€§æŒ‚è½½åˆ†åŒº

**ä¿®æ”¹ `/etc/fstab` é…ç½®æ–‡ä»¶**

```bash
#
# /etc/fstab
# Created by anaconda on Sat Jun 15 00:02:03 2024
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root   /                       xfs     defaults        0 0
UUID=e9d2f254-90ec-43d8-a621-744af0a79e14 /boot                   xfs     defaults        0 0
/dev/mapper/rhel-swap   none                    swap    defaults        0 0
```

```bash
ç¬¬ä¸€åˆ— æ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨åˆ†åŒºè·¯å¾„
ç¬¬äºŒåˆ— æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹
ç¬¬ä¸‰åˆ— æ–‡ä»¶ç³»ç»Ÿç±»å‹
ç¬¬å››åˆ— æŒ‚è½½å‚æ•°
ç¬¬äº”åˆ— è½¬å‚¨é¢‘ç‡ ä½¿ç”¨dumpè½¬å‚¨ 0è¡¨ç¤ºä¸å¤‡ä»½ 1è¡¨ç¤ºæ¯å¤© 2è¡¨ç¤ºéš”å¤©
ç¬¬å…­åˆ— æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥é¡ºåº 0ä¸éœ€è¦æ£€æŸ¥ 1ç”¨äºæ ¹æ–‡ä»¶ç³»ç»Ÿ 2ç”¨äºå…¶ä»–æ–‡ä»¶ç³»ç»Ÿ
```

<aside>
ğŸ’¡ `mount -a` å‘½ä»¤ä¼šæŒ‰ç…§/etc/fstabä¸­å†™çš„æŒ‚è½½ å·²ç»æŒ‚è½½çš„å°†ä¸ä¼šè¢«æ“ä½œ

</aside>

**æŸ¥çœ‹å—è®¾å¤‡çš„uuid**

`/dev/disk/by-uuid`

```bash
lrwxrwxrwx. 1 root root  9 Jul 13 21:27 2023-04-13-16-58-02-00 -> ../../sr0
lrwxrwxrwx. 1 root root 15 Jul 13 21:27 30cf8aea-aaf8-4cf6-aad5-27b051fa2a3d -> ../../nvme0n2p1
lrwxrwxrwx. 1 root root 10 Jul 13 21:27 54587d34-fd74-461c-987a-0dd972e7bcd4 -> ../../dm-0
lrwxrwxrwx. 1 root root 10 Jul 13 21:27 6bb8e20a-6640-4f87-b214-2897c205bf6f -> ../../dm-1
lrwxrwxrwx. 1 root root 15 Jul 13 21:27 a0685764-c2ae-4982-9c40-1e56bf0d0cc0 -> ../../nvme0n2p5
lrwxrwxrwx. 1 root root 15 Jul 13 21:27 a5336069-e6c4-4935-a34d-d4aaa7589480 -> ../../nvme0n2p6
lrwxrwxrwx. 1 root root 15 Jul 13 21:27 e9d2f254-90ec-43d8-a621-744af0a79e14 -> ../../nvme0n1p1
```

### é€»è¾‘å· â€” è§£å†³æ ‡å‡†åˆ†åŒºæ‰©å®¹é—®é¢˜

**å…³äºé€»è¾‘å·çš„æŠ½è±¡æ¦‚å¿µ**

```bash
pv (physical volume) ç‰©ç†å·

vg (volume group) å·ç»„

lv (logical volume) é€»è¾‘å·
```

**åˆ›å»ºç‰©ç†å· pv**

`pvcreate å—è·¯å¾„`

```bash
[root@CitProbe dev] **pvcreate /dev/nvme0n2p2**
  Physical volume "/dev/nvme0n2p2" successfully created.
```

**æŸ¥çœ‹pvæ± **

`pvs`

```bash
[root@CitProbe dev] **pvs**
  PV             VG   Fmt  Attr PSize   PFree
  /dev/nvme0n1p2 rhel lvm2 a--  <19.00g    0
  /dev/nvme0n2p1      lvm2 ---    2.00g 2.00g
  /dev/nvme0n2p2      lvm2 ---    2.00g 2.00g
```

**åˆ é™¤pvä¸­çš„å—è®¾å¤‡**

`pvremove å—è·¯å¾„`

```bash
[root@CitProbe dev] **pvremove /dev/nvme0n2p2**
  Labels on physical volume "/dev/nvme0n2p2" successfully wiped.
[root@CitProbe dev] pvs
  PV             VG   Fmt  Attr PSize   PFree
  /dev/nvme0n1p2 rhel lvm2 a--  <19.00g    0
  /dev/nvme0n2p1      lvm2 ---    2.00g 2.00g
```

**ä»pvæ± ä¸­é€‰å–å—åˆ›å»ºvgå·ç»„**

`vgcreate å·ç»„å pvæ± ä¸­å—å`

```bash
[root@CitProbe dev] **vgcreate vg-1 /dev/nvme0n2p1**
  Volume group "vg-1" successfully created
```

**æŸ¥çœ‹å·ç»„**

`vgs`

```bash
[root@CitProbe dev] vgs
  VG   #PV #LV #SN Attr   VSize   VFree
  rhel   1   2   0 wz--n- <19.00g     0
  vg-1   1   0   0 wz--n-  <2.00g <2.00g
```

**åˆ é™¤å·ç»„**

`vgremove å·ç»„å`

```bash
[root@CitProbe dev] **vgremove vg-1**
  Volume group "vg-1" successfully removed
[root@CitProbe dev] vgs
  VG   #PV #LV #SN Attr   VSize   VFree
  rhel   1   2   0 wz--n- <19.00g    0
```

**ä»pvé€‰å–å—æ‰©å®¹vg**

`vgextend æ¬²æ‰©å®¹vgå pvå—`

```bash
[root@CitProbe dev] **vgextend vg1 /dev/nvme0n2p2**
  Volume group "vg1" successfully extended
[root@CitProbe dev]
[root@CitProbe dev] vgs
  VG   #PV #LV #SN Attr   VSize   VFree
  rhel   1   2   0 wz--n- <19.00g    0
  vg1    2   0   0 wz--n-   3.99g 3.99g
```

**ç¼©å®¹vg**

`vgreduce æ¬²ç¼©å®¹vgå æ¬²åˆ æ‰çš„å—`

```bash
[root@CitProbe dev] **vgreduce vg1 /dev/nvme0n2p2**
  Removed "/dev/nvme0n2p2" from volume group "vg1"
[root@CitProbe dev] vgs
  VG   #PV #LV #SN Attr   VSize   VFree
  rhel   1   2   0 wz--n- <19.00g     0
  vg1    1   0   0 wz--n-  <2.00g <2.00g
```

**vgå·ç»„çš„PE**

```bash
ç”¨æˆ·ä»pvæ± ä¸­åˆ›å»ºvgæ—¶ æˆ–è€…æ‰©å®¹vg
ç®€è€Œè¨€ä¹‹ å¤„åœ¨vgä¸­çš„å—è®¾å¤‡
éƒ½ä¼šè¢«åˆ’åˆ†æˆè‹¥å¹²ä¸ªPE ç±»ä¼¼äºæ ‡å‡†åˆ†åŒºä¸­çš„block
vgä¸‹çš„é€»è¾‘å· å¯ä»¥æŒ‡å®šåº”ç”¨å¤šå°‘ä¸ªPE
è¿™ä¹Ÿæ˜¯vgå’Œlvå¯ä»¥æ‰©å®¹çš„åŸç†
```

**æŒ‡å®švgä¸­çš„PEå¤§å°**

`vgcreate å·ç»„å pvä¸­çš„å— -s PEå¤§å°(å¦‚8M)`

```bash
[root@CitProbe dev] **vgcreate vg1 /dev/nvme0n2p1 -s 8M**
  Volume group "vg1" successfully created
  [root@CitProbe dev] **vgdisplay vg1**
  --- Volume group ---
  VG Name               vg1
  System ID
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               1.99 GiB
  **PE Size               8.00 MiB**
  Total PE              255
  Alloc PE / Size       0 / 0
  Free  PE / Size       255 / 1.99 GiB
  VG UUID               RQZ1FZ-cals-THgU-4ZGL-wVTw-3E1T-zIwvXY
```

**ä»vgåˆ›å»ºlvé€»è¾‘å·**

`lvcreate -n é€»è¾‘å·å -L é€»è¾‘å·å¤§å° ä½¿ç”¨çš„vgå·ç»„å`

```bash
[root@CitProbe dev] **lvcreate -n lv1 -L 300M vg1**
  Rounding up size to full physical extent 304.00 MiB
  Logical volume "lv1" created.
```

**æŸ¥çœ‹lvä¿¡æ¯**

`lvs`

```bash
[root@CitProbe dev] lvs
  LV   VG   Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root rhel -wi-ao---- <17.00g

  swap rhel -wi-ao----   2.00g

  lv1  vg1  -wi-a----- 304.00m
```

<aside>
ğŸ’¡ é€»è¾‘å·åˆ›å»ºå®Œæˆä¹‹å å¯ä»¥ç›´æ¥æ ¼å¼åŒ–æˆä¸ºæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨

</aside>

<aside>
ğŸ’¡ `/dev/vgname/` ä¸­å­˜æ”¾äº†é€»è¾‘å·å—è®¾å¤‡

</aside>

```bash
[root@CitProbe dev] **ls -l /dev/vg1/**
total 0
lrwxrwxrwx. 1 root root 7 Jul 13 22:54 lv1 -> ../dm-2
lrwxrwxrwx. 1 root root 7 Jul 13 23:04 lv2 -> ../dm-3
lrwxrwxrwx. 1 root root 7 Jul 13 23:05 lv3 -> ../dm-4
```

**lvçš„æ ¼å¼åŒ–**

`mkfsæ–‡ä»¶ç³»ç»Ÿ å—è·¯å¾„`

```bash
[root@CitProbe dev] **mkfs.ext4 /dev/vg1/lv1**
mke2fs 1.46.5 (30-Dec-2021)
Creating filesystem with 311296 1k blocks and 77824 inodes
Filesystem UUID: 0327b578-e9c1-4c51-9da0-5d6a2f8389e6
Superblock backups stored on blocks:
        8193, 24577, 40961, 57345, 73729, 204801, 221185

Allocating group tables: done
Writing inode tables: done
Creating journal (8192 blocks): done
Writing superblocks and filesystem accounting information: done
```

**lvçš„åˆ é™¤**

`lvremove lvç»å¯¹è·¯å¾„`

```bash
[root@CitProbe dev] lvs
  LV   VG   Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root rhel -wi-ao---- <17.00g

  swap rhel -wi-ao----   2.00g

  lv1  vg1  -wi-a----- 304.00m

  lv2  vg1  -wi-a----- 800.00m

  lv3  vg1  -wi-a-----   1.00g

[root@CitProbe dev] **lvremove /dev/vg1/lv3**
Do you really want to remove active logical volume vg1/lv3? [y/n]: y
  Logical volume "lv3" successfully removed.
[root@CitProbe dev] lvs
  LV   VG   Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root rhel -wi-ao---- <17.00g

  swap rhel -wi-ao----   2.00g

  lv1  vg1  -wi-a----- 304.00m

  lv2  vg1  -wi-a----- 800.00m
```

**lvçš„æ‰©å®¹**

```bash
[root@CitProbe dev] **mkfs.ext4 /dev/vg1/lv1  #æ ¼å¼åŒ–lv1é€»è¾‘ç£ç›˜ å¹¶ä½¿ç”¨ex4æ–‡ä»¶ç³»ç»Ÿ**
[root@CitProbe dev] **mkfs.xfs /dev/vg1/lv2   #æ ¼å¼åŒ–lv2é€»è¾‘ç£ç›˜ å¹¶ä½¿ç”¨xfsæ–‡ä»¶ç³»ç»Ÿ**
[root@CitProbe dev] **mount /dev/vg1/lv1 /mount1  #ä¸´æ—¶æŒ‚è½½lv1é€»è¾‘ç£ç›˜åˆ°/mount1**
[root@CitProbe dev] **mount /dev/vg1/lv2 /mount2  #ä¸´æ—¶æŒ‚è½½lv2é€»è¾‘ç£ç›˜åˆ°/mount2**
[root@CitProbe dev] df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               4.0M     0  4.0M   0% /dev
tmpfs                  1.8G     0  1.8G   0% /dev/shm
tmpfs                  728M  9.7M  718M   2% /run
/dev/mapper/rhel-root   17G  4.2G   13G  25% /
/dev/nvme0n1p1        1014M  292M  723M  29% /boot
tmpfs                  364M   52K  364M   1% /run/user/42
tmpfs                  364M   36K  364M   1% /run/user/0
/dev/mapper/vg1-lv1    275M   14K  256M   1% /mount1
/dev/mapper/vg1-lv2    794M   38M  757M   5% /mount2

*# require
# æ‰©å®¹ /dev/vg1/lv1 åˆ° 500M
# æ‰©å®¹ /dev/vg1/lv2 åˆ° 1.00G*

[root@CitProbe dev] **lvextend /dev/vg1/lv1 -L 500M #æ‰©å®¹lv1é€»è¾‘ç£ç›˜åˆ°500M**
[root@CitProbe dev] **lvextend /dev/vg1/lv2 -L 1G   #æ‰©å®¹lv2é€»è¾‘ç£ç›˜åˆ°1.00G**
[root@CitProbe dev] lvs
  LV   VG   Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root rhel -wi-ao---- <17.00g

  swap rhel -wi-ao----   2.00g

  lv1  vg1  -wi-ao---- 504.00m

  lv2  vg1  -wi-ao----   1.00g
  
[root@CitProbe dev] df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               4.0M     0  4.0M   0% /dev
tmpfs                  1.8G     0  1.8G   0% /dev/shm
tmpfs                  728M  9.7M  718M   2% /run
/dev/mapper/rhel-root   17G  4.2G   13G  25% /
/dev/nvme0n1p1        1014M  292M  723M  29% /boot
tmpfs                  364M   52K  364M   1% /run/user/42
tmpfs                  364M   36K  364M   1% /run/user/0
/dev/mapper/vg1-lv1    275M   14K  256M   1% /mount1
/dev/mapper/vg1-lv2    794M   38M  757M   5% /mount2

# è¿™é‡Œå‘ç°æŒ‚è½½ç›®å½•å¤§å°å¹¶æ²¡æœ‰è¢«æ‰©å®¹ è€Œä½¿ç”¨lvsæŸ¥çœ‹çš„å—å·²ç»è¢«æ‰©å®¹
# å¯¹äºex4ç³»åˆ—æ–‡ä»¶ç³»ç»Ÿ ä½¿ç”¨ **resize2fs** å—è®¾å¤‡è·¯å¾„ é‡æ–°å¯¹å—åšæ–‡ä»¶ç³»ç»Ÿ
# å¯¹äºxfsç³»åˆ—æ–‡ä»¶ç³»ç»Ÿ ä½¿ç”¨ **xfs_growfs** æŒ‚è½½ç‚¹è·¯å¾„ é‡æ–°å¯¹å—åšæ–‡ä»¶ç³»ç»Ÿ

[root@CitProbe dev] **resize2fs /dev/vg1/lv1  #é‡æ–°å¯¹lv1é€»è¾‘ç£ç›˜åˆ¶ä½œæ–‡ä»¶ç³»ç»Ÿ**
resize2fs 1.46.5 (30-Dec-2021)
Filesystem at /dev/vg1/lv1 is mounted on /mount1; on-line resizing required
old_desc_blocks = 3, new_desc_blocks = 4
The filesystem on /dev/vg1/lv1 is now 516096 (1k) blocks long.

[root@CitProbe dev] **xfs_growfs /mount2      #é‡æ–°å¯¹lv2é€»è¾‘ç£ç›˜åˆ¶ä½œæ–‡ä»¶ç³»ç»Ÿ**
meta-data=/dev/mapper/vg1-lv2    isize=512    agcount=4, agsize=51200 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1    bigtime=1 inobtcount=1
data     =                       bsize=4096   blocks=204800, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=1566, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
data blocks changed from 204800 to 262144
[root@CitProbe dev] **df -Th**
Filesystem            Type      Size  Used Avail Use% Mounted on
devtmpfs              devtmpfs  4.0M     0  4.0M   0% /dev
tmpfs                 tmpfs     1.8G     0  1.8G   0% /dev/shm
tmpfs                 tmpfs     728M  9.7M  718M   2% /run
/dev/mapper/rhel-root xfs        17G  4.2G   13G  25% /
/dev/nvme0n1p1        xfs      1014M  292M  723M  29% /boot
tmpfs                 tmpfs     364M   52K  364M   1% /run/user/42
tmpfs                 tmpfs     364M   36K  364M   1% /run/user/0
/dev/mapper/vg1-lv1   ext4      463M   14K  435M   1% /mount1
/dev/mapper/vg1-lv2   xfs      1018M   40M  979M   4% /mount2
```

**ä½¿ç”¨findæŸ¥æ‰¾æ–‡ä»¶**

`find é€‰é¡¹ å‚æ•°`

```bash
-name æŒ‡å®šåå­—
-user æŒ‡å®šæ‹¥æœ‰äºº
-size æŒ‡å®šå¤§å° +100M å¤§äº100M -100M å°äº100M
```

**findé…åˆcp**

`find èŒƒå›´ å‚æ•° 2>>/dev/null -exec cp -a {} ç›®çš„ \;`

**ddå‘½ä»¤**

`dd if=å†™å…¥è®¾å¤‡ of=è¢«å†™å…¥æ–‡ä»¶ bs=å—å¤§å° count=å—æ•°é‡`

```bash
[root@CitProbe ~] dd if=/dev/zero of=/root/file bs=1M count=1024
1024+0 records in
1024+0 records out
1073741824 bytes (1.1 GB, 1.0 GiB) copied, 4.116 s, 261 MB/s
[root@CitProbe ~] ls -lh file
-rw-r--r--. 1 root root 1.0G Jul 14 12:34 file
```

**ä½¿ç”¨lnåˆ›å»ºè½¯é“¾æ¥**

`ln å‚æ•° è¢«é“¾æ¥æ–‡ä»¶ é“¾æ¥æ–‡ä»¶`

```bash
-s åˆ›å»ºè½¯é“¾æ¥
```

### swapäº¤æ¢åˆ†åŒº â€” æä¾›è™šæ‹Ÿå†…å­˜è§£å†³æ–¹æ¡ˆ

```bash
[root@CitProbe dev] ls -l /dev/sda
brw-rw----. 1 root disk 8, 0 Jul 14 12:49 /dev/sda
[root@CitProbe dev] **fdisk /dev/sda # ä¸ºå—åˆ¶ä½œæ ‡å‡†åˆ†åŒº**

Welcome to fdisk (util-linux 2.37.4).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Command (m for help): n
Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p):

Using default response p.
Partition number (1-4, default 1):
First sector (2048-33554431, default 2048):
Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-33554431, default 33554431):

Created a new partition 1 of type 'Linux' and of size 16 GiB.
Partition #1 contains a swap signature.

Do you want to remove the signature? [Y]es/[N]o: y

The signature will be removed by a write command.

Command (m for help): p
Disk /dev/sda: 16 GiB, 17179869184 bytes, 33554432 sectors
Disk model: VMware Virtual S
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x7a95dff1

Device     Boot Start      End  Sectors Size Id Type
/dev/sda1        2048 33554431 33552384  16G 83 Linux

Filesystem/RAID signature on partition 1 will be wiped.

Command (m for help): w
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.

[root@CitProbe dev] **mkswap /dev/sda1 # åˆå§‹åŒ–ç£ç›˜æ ¼å¼ä¸ºswap**
Setting up swapspace version 1, size = 16 GiB (17178816512 bytes)
no label, UUID=5fb2d019-f2b8-4eaa-a18d-9e3741fe617a
[root@CitProbe dev] **swapon /dev/sda1 # ä¸´æ—¶æŒ‚è½½swapåˆ†åŒº**
[root@CitProbe dev] free -h
               total        used        free      shared  buff/cache   available
Mem:           1.7Gi       962Mi       521Mi        14Mi       437Mi       788Mi
Swap:           17Gi          0B        17Gi
[root@CitProbe dev] **echo "/dev/sda1 swap swap defaults 0 0" >> /etc/fstab # å†™å…¥/etc/fstab ä¸­ å®ç°å¼€æœºè‡ªæŒ‚è½½**
```

## Network File System ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ

### ä¸‹è½½nfs

`yum install -y nfs-utils`

### é…ç½®nfs

`/etc/exports`

```bash
# /etc/exports

/lv-share 192.168.80.100(rw)
#å…±äº«ç›®å½• å¯è®¿é—®çš„IP     å¯¹ç›®å½•çš„æ“ä½œæƒé™
```

```bash
[root@CitProbe lv-share] exportfs #æŸ¥çœ‹åˆ†äº«çŠ¶æ€
/lv-share       192.168.80.100
```

**åœ¨è¿œç«¯æŒ‚è½½nfsç£ç›˜**

```bash
[root@CitProbe ~] **mount -t nfs 192.168.80.101:/lv-share /lv-mount**
[root@CitProbe ~] df -Th
Filesystem               Type      Size  Used Avail Use% Mounted on
devtmpfs                 devtmpfs  4.0M     0  4.0M   0% /dev
tmpfs                    tmpfs     1.8G     0  1.8G   0% /dev/shm
tmpfs                    tmpfs     728M  9.7M  718M   2% /run
/dev/mapper/rhel-root    xfs        17G  5.2G   12G  31% /
/dev/nvme0n1p1           xfs      1014M  292M  723M  29% /boot
/dev/mapper/vg1-lv2      xfs      1018M   40M  979M   4% /mount2
/dev/mapper/vg1-lv1      ext4      463M   14K  435M   1% /mount1
tmpfs                    tmpfs     364M   52K  364M   1% /run/user/42
tmpfs                    tmpfs     364M   36K  364M   1% /run/user/0
192.168.80.101:/lv-share nfs4      8.8G     0  8.3G   0% /lv-mount
```

**å°†è‡ªåŠ¨æŒ‚è½½å†™å…¥fstab**

```bash
# /etc/fstab
192.168.80.101:/lv-share /lv-mount nfs default 0 0
```

**è®¾ç½®å¼€æœºè‡ªå¯åŠ¨nfsæœåŠ¡**

`systemctl enable nfs-service`

## Virtual Data Optimizer è™šæ‹Ÿæ•°æ®ä¼˜åŒ–å™¨

### éœ€è¦çš„è½¯ä»¶åŒ…

`kmod-kvdo`

`vdo`

ç»†èŠ‚ç•¥

## autofs è‡ªåŠ¨æ–‡ä»¶ç³»ç»Ÿ

### éœ€è¦çš„è½¯ä»¶åŒ…

`autofs`

`libsss_autofs`

### é…ç½®æ–‡ä»¶

```bash
/etc/auto.master ä¸»é…ç½®æ–‡ä»¶
/etc/auto.misc   ä¸»é…ç½®æ–‡ä»¶è°ƒç”¨çš„å­é…ç½®æ–‡ä»¶
```

```bash
# /etc/auto.master

# Sample auto.master file
# This is a 'master' automounter map and it has the following format:
# mount-point [map-type[,format]:]map [options]
# For details of the format look at auto.master(5).
#
/misc         /etc/auto.misc
#æŒ‚è½½ç‚¹çˆ¶ç›®å½• æ ¹æ®å“ªä¸ªé…ç½®æ–‡ä»¶æŒ‚è½½
```

```bash
# /etc/auto.misc

# This is an automounter map and it has the following format
# key [ -mount-options-separated-by-comma ] location
# Details may be found in the autofs(5) manpage

cd              -fstype=iso9660,ro,nosuid,nodev :/dev/cdrom
**æŒ‚è½½ç›®å½•åç§°    å—è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿ æƒé™             è¢«æŒ‚è½½å—è®¾å¤‡**
# the following entries are samples to pique your imagination
#linux          -ro,soft                ftp.example.org:/pub/linux
#boot           -fstype=ext2            :/dev/hda1
#floppy         -fstype=auto            :/dev/fd0
#floppy         -fstype=ext2            :/dev/fd0
#e2floppy       -fstype=ext2            :/dev/fd0
#jaz            -fstype=ext2            :/dev/sdc1
#removable      -fstype=ext2            :/dev/hdd
```

**å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯autofsæœåŠ¡**

`systemctl start autofs`

`systemctl enable autofs`

**å®æˆ˜ Task ï¼šä½¿ç”¨autofsæŒ‚è½½/dev/nvme0n2p1 åˆ° /mount1 é€šè¿‡nfsæœåŠ¡å…±äº«/mount1 åˆ° 192.168.80.100ä¸»æœº**

```bash
# /etc/auto.master
/mount1 /etc/auto.mount1
[root@CitProbe misc] cp -a /etc/auto.misc /etc/auto.mount1
# /etc/auto.mount1
arcdisk  -fstype=ext4,rw  :/dev/nvme0n2p1
[root@CitProbe mount] systemctl restart autofs
[root@CitProbe mount] cd /mount1
[root@CitProbe mount1] ls
[root@CitProbe mount1] ls arcdisk
lost+found
[root@CitProbe mount1] ls
arcdisk

[root@CitProbe mount1] systemctl start nfs-utils.service
# /etc/exports
/mount1 192.168.80.100(rw)
[root@CitProbe mount1] systemctl restart nfs-utils.service
[root@CitProbe mount1] exportfs
/lv-share       192.168.80.100

# æ³¨æ„æœåŠ¡ç«¯firewalld å’Œ selinux çš„çŠ¶æ€
[root@CitProbe mount1] systemctl stop firewalld
[root@CitProbe mount1] setenforce 0

# åœ¨192.168.80.100ä¸Šé…ç½®

[root@CitProbe /] mount -t nfs 192.168.80.101:/mount1 /mount-net
mount.nfs: access denied by server while mounting 192.168.80.101:/mount1

```

## System Rescue ç³»ç»Ÿæ•‘æ´

<aside>
ğŸ’¡ åœ¨ç³»ç»Ÿå¯åŠ¨é€‰é¡¹å¤„æŒ‰eè¿›å…¥ åœ¨åæ–¹å†™å…¥ `rd.break` è¿›å…¥ç³»ç»Ÿæ•‘æ´

</aside>

```bash
mount -o rw,remount /sysroot # å°†/sysrooté‡æ–°æŒ‚è½½ä¸ºè¯»å†™æ¨¡å¼
chroot /sysroot # å°†/sysrootç›®å½•ä½œä¸ºå®¶ç›®å½•
passwd root # é‡æ–°ä¿®æ”¹rootå¯†ç 
touch /.autorelabel # SELinux åœ¨å¯åŠ¨æ—¶å¦‚æœæ£€æµ‹åˆ°è¿™ä¸ªæ–‡ä»¶ä¼šç›´æ¥å¯¹æ•´ä¸ªç³»ç»Ÿå…¨éƒ¨é‡æ–°æ ‡ç­¾ æ­¤æ“ä½œç»•è¿‡äº†SELinuxçš„æ£€æµ‹
exit
exit # é€€å‡ºå¹¶é‡å¯
```

## å‹ç¼© ä¸ æ–‡ä»¶å½’æ¡£

### æ–‡ä»¶å½’æ¡£ tar å‚æ•°

```bash
-c åˆ›å»ºæ–°çš„å‹ç¼©
-x ä»å‹ç¼©åŒ…ä¸­æå–æ–‡ä»¶ è§£å‹ç¼©
-z ä½¿ç”¨gzipå‹ç¼©æ ¼å¼
-v æ˜¾ç¤ºæ‰§è¡Œè¯¦ç»†ä¿¡æ¯
-f æŒ‡å®šå‹ç¼©åŒ…æ–‡ä»¶
```

## Tuned ç³»ç»Ÿè°ƒä¼˜

### å¼€å¯TunedæœåŠ¡

`yum install -y tuned`

`systemctl start tuned`

`systemctl enable tuned`

### é…ç½®æ–‡ä»¶

```bash

```

### æŸ¥çœ‹ç³»ç»Ÿæ¨èå€¼

```bash
[root@CitProbe ~] tuned-adm recommend
virtual-guest
```

### åº”ç”¨è°ƒä¼˜æ–‡ä»¶

```bash
[root@CitProbe ~] tuned-adm profile virtual-guest
Cannot talk to TuneD daemon via DBus. Is TuneD daemon running?
Trying to (re)start tuned...
TuneD (re)started, changes applied.
```

### ç¦ç”¨ç³»ç»Ÿè°ƒä¼˜

```bash
[root@CitProbe ~] tuned-adm off
```

```bash
[root@CitProbe ~] systemctl stop tuned
```