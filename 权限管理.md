# æƒé™ç®¡ç†

**æƒé™çš„ä½œç”¨**

æ™®é€šæ–‡ä»¶å’Œç›®å½•æ–‡ä»¶çš„æƒé™æ˜¯ä¸ä¸€æ ·çš„

```bash
[root@CitProbe ~] ls -l
total 4
-rw-------. 1 root root 950 Jun 15 08:10 anaconda-ks.cfg
drwxr-xr-x. 2 root root   6 Jun 15 09:28 Desktop
drwxr-xr-x. 2 root root   6 Jun 15 09:28 Documents
drwxr-xr-x. 2 root root   6 Jun 15 09:28 Downloads
drwxr-xr-x. 2 root root   6 Jun 15 09:28 Music
drwxr-xr-x. 2 root root   6 Jun 15 09:28 Pictures
drwxr-xr-x. 2 root root   6 Jun 15 09:28 Public
drwxr-xr-x. 2 root root   6 Jun 15 09:28 Templates
drwxr-xr-x. 2 root root   6 Jun 15 09:28 Videos
```

### æƒé™å¯¹äºæ–‡ä»¶çš„ä½œç”¨

- **æƒé™å¯¹äºæ™®é€šæ–‡ä»¶çš„ä½œç”¨**

> ä¹åˆ—æƒé™ å‰ä¸‰åˆ—è¡¨ç¤ºæ–‡ä»¶æ‹¥æœ‰è€…å…·æœ‰çš„æƒé™ ä¸­é—´ä¸‰åˆ—è¡¨ç¤ºæ‰€å±ç»„æ‹¥æœ‰çš„æƒé™ åä¸‰åˆ—è¡¨ç¤ºå…¶ä»–äººå…·æœ‰çš„æƒé™
> 
- **æƒé™å¯¹äºç›®å½•æ–‡ä»¶çš„ä½œç”¨**

> r è¡¨ç¤ºåœ¨è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶å¯ä»¥è¢«æŸ¥çœ‹å±æ€§ `ls`
> 

> wè¡¨ç¤ºåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º ä¿®æ”¹ ç¼–è¾‘æ–‡ä»¶æˆ–æ–‡ä»¶å±æ€§
> 

> xè¡¨ç¤ºå¯ä»¥è¿›å…¥è¯¥ç›®å½• ä¸ræƒé™ä¸ç›¸å†²çª
> 

---

### é’ˆå¯¹æ–‡ä»¶è®¾ç½®æƒé™

- ä¿®æ”¹æ–‡ä»¶çš„ æ‹¥æœ‰äºº æ‰€å±ç»„

`chown æ‹¥æœ‰äºº:æ‰€å±ç»„ æ–‡ä»¶å` #å‰åå¯ä»¥çœç•¥å…¶ä¸€

```bash
[root@CitProbe arc] ls -l ttt
----------. 1 root arc 11 Jul  4 09:50 ttt
[root@CitProbe arc] chown arc ttt
[root@CitProbe arc] ls -l ttt
----------. 1 arc arc 11 Jul  4 09:50 ttt
[root@CitProbe arc] chown :root ttt
[root@CitProbe arc] ls -l ttt
----------. 1 arc root 11 Jul  4 09:50 ttt
[root@CitProbe arc] chown arc:arc ttt
[root@CitProbe arc] ls -l ttt
----------. 1 arc arc 11 Jul  4 09:50 ttt
```

- è®¾ç½®æ–‡ä»¶æƒé™

`chmod å‚æ•°è¡¨ æ–‡ä»¶å`

```bash
chmod u=rwx,g=rwx,o=rwx ttt #æƒé™ç­‰ç®—
chmod u-rwx,g-rwx,o-rwx ttt #æƒé™å‡æ³•
chmod u+rwx,g+rwx,o+rwx ttt #æƒé™åŠ æ³•
chmod 777 ttt #æƒé™421è¡¨ç¤ºæ³•
chmod +x ttt #æƒé™xå¯¹æ‰€æœ‰äººæ·»åŠ 
```

<aside>
ğŸ”‘ åªæœ‰æ–‡ä»¶çš„æ‹¥æœ‰äººæ‰å¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„æƒé™ rooté™¤å¤– ç†è®ºä¸Šæ–‡ä»¶çš„æ‹¥æœ‰äººå¯¹æ–‡ä»¶æ‹¥æœ‰æƒé™æ ‡æ˜çš„æƒé™ å®é™…ä¸Šæ‹¥æœ‰äººå¯¹äºæ–‡ä»¶æ‹¥æœ‰ä¸€åˆ‡æƒé™ ä»»ä½•è¶Šç•Œæ“ä½œå¯¹äºè‡ªå·±çš„æ–‡ä»¶éƒ½å¯ä»¥å¼ºåˆ¶æ‰§è¡Œ

</aside>

---

### ç‰¹æ®Šæƒé™

- **SET UID**

> ç”¨äºå¯æ‰§è¡Œçš„æ™®é€šæ–‡ä»¶ ä»»ä½•äººä¸€æ—¦æ‰§è¡Œè¯¥æ–‡ä»¶ æ‰§è¡Œäººå°†ä¸´æ—¶è·å¾—æ–‡ä»¶æ‹¥æœ‰è€…çš„æƒé™
> 

å½“ä¸€ä¸ªæ–‡ä»¶ æ–‡ä»¶æ‹¥æœ‰è€…æƒé™åˆ—æ‰§è¡Œæƒé™ä¸ºsæˆ–S åˆ™è¡¨æ˜è¿™ä¸ªæ–‡ä»¶å…·æœ‰SET UIDç‰¹æ®Šæƒé™

`chmod u+s æ–‡ä»¶åç§°`

```bash
[root@CitProbe ~] ls -l /bin/passwd
-rw**s**r-xr-x. 1 root root 32648 Aug 10  2021 /bin/passwd
```

- **SET GID**

> ç”¨äºç›®å½• æ‹¥æœ‰è¿™ä¸ªæƒé™çš„ç›®å½• ä»»ä½•ç”¨æˆ·åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ æ–‡ä»¶çš„æ‰€å±ç»„éƒ½ä¼šå˜æˆè¢«SET GIDç›®å½•çš„æ‰€å±ç»„
> 

å½“ä¸€ä¸ªç›®å½• æ–‡ä»¶æ‰€å±ç»„æƒé™åˆ—æ‰§è¡Œæƒé™ä¸ºsæˆ–S åˆ™è¡¨æ˜è¿™ä¸ªç›®å½•å…·æœ‰SET GIDç‰¹æ®Šæƒé™

`chmod g+s æ–‡ä»¶åç§°`

```bash
[root@CitProbe ~] ls -ld ts
drwxrw**s**rwx. 2 root root 6 Jul  4 12:43 ts
```

- **Sticky**

> ç”¨äºæœ‰å†™æƒé™ç›®å½•çš„ç‰¹æ®Šæƒé™ä½ å½“ä¸€ä¸ªæœ‰å†™æƒé™ç›®å½•è®¾ç½®äº†Sticky é‚£ä¹ˆä»»ä½•äººåœ¨è¯¥ç›®å½•ä¸­åˆ›å»ºçš„æ–‡ä»¶åªæœ‰è‡ªå·±å’Œrootèƒ½åˆ é™¤
> 

å½“ä¸€ä¸ªç›®å½• æ–‡ä»¶å…¶ä»–äººæƒé™åˆ—æ‰§è¡Œæƒé™ä¸ºtæˆ–T åˆ™è¡¨æ˜è¿™ä¸ªç›®å½•å…·æœ‰Stickyç‰¹æ®Šæƒé™

`chmod o+t æ–‡ä»¶åç§°`

```bash
[root@CitProbe ~] ls -ld /tmp
drwxrwxrw**t**. 20 root root 4096 Jul  4 12:21 /tmp
```

<aside>
ğŸ”‘ åœ¨æ·»åŠ ç‰¹æ®Šæƒé™æ—¶ æ‰§è¡Œæƒé™ä½ä¼šè¢«è¦†ç›– å½“ç‰¹æ®Šæƒé™ä¸ºå°å†™æ—¶ è¡¨æ˜æƒé™ä½æ‹¥æœ‰æ‰§è¡Œæƒé™ å½“ä¸ºå¤§å†™æ—¶ è¡¨æ˜æƒé™ä½æ²¡æœ‰æ‰§è¡Œæƒé™

</aside>

---

### ç³»ç»Ÿç¼ºçœæƒé™ umask

åˆ›å»ºç›®å½•çš„ç¼ºçœæƒé™æ˜¯ `rwxrwxrwx`

åˆ›å»ºæ–‡ä»¶çš„ç¼ºçœæƒé™æ˜¯ `rw-rw-rw-`

umaskèƒ½å¸®åŠ©ç”¨æˆ·ä¿®æ”¹åˆ›å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™

```bash
**umask** **å››ä½æ•°å­—**
```

åˆ›å»ºç›®å½•çš„æœ€ç»ˆæƒé™ å°±æ˜¯`rwxrwxrwx`å‡å»umaskçš„å3ä½æ‰€ä»£è¡¨çš„äºŒè¿›åˆ¶æƒé™

åˆ›å»ºæ–‡ä»¶çš„æœ€ç»ˆæƒé™ å°±æ˜¯`rw-rw-rw-`å‡å»umaskçš„å3ä½æ‰€ä»£è¡¨çš„äºŒè¿›åˆ¶æƒé™

**æ–‡ä»¶æœ€ç»ˆåˆ›å»ºçš„ç¼ºçœæƒé™æ˜¯å°†æ–‡ä»¶åˆ›å»ºç¼ºçœæƒé™å‡å»umaskä»£è¡¨çš„ç¼ºçœæƒé™**

å‘½ä»¤è¡Œçš„ä¿®æ”¹åªæ˜¯ä¸´æ—¶ä¿®æ”¹ umaskçš„ç¯å¢ƒå˜é‡å­˜æ”¾åœ¨ 

**å…¨å±€çš„** `/etc/bashrc` 

**ä¸ªäººçš„** `/home/ç”¨æˆ·åå­—/.bashrc`

è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶æ˜¯ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ å…¶ä¸­åŒ…å«umaskç¯å¢ƒå˜é‡

```bash
#/etc/bashrc å…¨å±€ç¯å¢ƒå˜é‡

[root@CitProbe ~] vim /etc/bashrc 
[root@CitProbe ~] cat /etc/bashrc | grep -A 3 "umask"
    # Set default umask for non-login shell only if it is set to 0
    [ `umask` -eq 0 ] && umask 022

    SHELL=/bin/bash
    # Only display echos from profile.d scripts if we are no login shell
```

---

### ACL ï¼ˆAccess Control Listï¼‰ è®¿é—®æ§åˆ¶åˆ—è¡¨

**ACL å¯ä»¥è®©æŒ‡å®šçš„ç”¨æˆ·æˆ–ç”¨æˆ·ç»„å¯¹æŸä¸ªæ–‡ä»¶æ‹¥æœ‰ç‰¹åˆ«çš„æƒé™**

**é’ˆå¯¹æ–‡ä»¶è®¾ç½®ACL**

`setfacl å‚æ•° å¯¹è±¡ç±»åˆ«:å¯¹è±¡åç§°:æƒé™åˆ—è¡¨(rwxå½¢å¼) æ–‡ä»¶åç§°`

**å‚æ•°ï¼š**

```bash
-b æ¸…ç©ºç­–ç•¥
-m ä¿®æ”¹ç­–ç•¥
-x ç§»é™¤ç­–ç•¥
```

**å¯¹è±¡ç±»åˆ«ï¼š**

```bash
u ç”¨æˆ·ç±»
g ç»„ç±»
```

**æŸ¥çœ‹ACLæƒé™ï¼š**

```bash
[root@CitProbe ~] setfacl -m u:arc:rwx anaconda-ks.cfg #æ·»åŠ ACLç­–ç•¥ä¸ºarcç”¨æˆ·å¯¹äºanaconda-ks.cfgæ‹¥æœ‰rwxæƒé™
[root@CitProbe ~] getfacl anaconda-ks.cfg #æŸ¥çœ‹anaconda-ks.cfgçš„ACLç­–ç•¥
# file: anaconda-ks.cfg
# owner: root
# group: root
user::rw-
user:arc:rwx
group::---
mask::rwx
other::---
```

> å‰ä¸‰è¡Œä¹‹å å…¨éƒ¨éƒ½æ˜¯ACLè¡¨æ ¼çš„å†…å®¹ ä¸»è¦æœ‰ä¸¤ç±» :
> 
- userå¼€å¤´ é’ˆå¯¹ç”¨æˆ·è®¾ç½®çš„æƒé™
- group å¼€å¤´ é’ˆå¯¹ç”¨æˆ·ç»„è®¾ç½®çš„æƒé™

æ ¼å¼ï¼š

```bash
user:user1:rwx   #ç”¨æˆ·1 å¯¹æ–‡ä»¶æœ‰rwx æƒé™
user:user2:rw    #ç”¨æˆ·2 å¯¹æ–‡ä»¶æœ‰rw  æƒé™
group:group1:rwx #ç»„1   å¯¹æ–‡ä»¶æœ‰rwx æƒé™
group:group2:rw  #ç»„2   å¯¹æ–‡ä»¶æœ‰rw  æƒé™

user::rwx        #onwer çš„æƒé™ä¸ºrwx
group::rwx       #group çš„æƒé™ä¸ºrwx
other::---       #other çš„æƒé™ä¸º---
```

<aside>
âš ï¸ ACLè¡¨ç”±ä¸Šåˆ°ä¸‹åŒ¹é… æƒé™åœ¨ç¬¬ä¸€æ¬¡åŒ¹é…ä¸­ç¡®å®š

</aside>

**é’ˆå¯¹ç›®å½•è®¾ç½®ACL ç›®çš„ä¸åœ¨äºè®¿é—®æ§åˆ¶ è€Œæ˜¯è®¿é—®ç»§æ‰¿**

> ç›®å½•é€šå¸¸åªæœ‰ä¸‰ç±»æƒé™æœ‰æ„ä¹‰ é’ˆå¯¹ç›®å½•æ“ä½œè®¾ç½®çš„è®¿é—®æ§åˆ¶åˆ—è¡¨æ„ä¹‰ä¸å¤§ æˆ‘ä»¬é€šå¸¸è®¾ç½®ç›®å½•çš„è®¿é—®æ§åˆ¶åˆ—è¡¨ç”¨äºç”¨æˆ·åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºçš„æ–‡ä»¶è‡ªåŠ¨ç»§æ‰¿ACLæƒé™
> 

**ä¸ºç›®å½•è®¾ç½®å…·æœ‰ç»§æ‰¿æ€§è´¨çš„ACLæƒé™**

`setfacl -m d:å¯¹è±¡ç±»åˆ«:å¯¹è±¡åç§°:æƒé™åˆ—è¡¨ æ–‡ä»¶åç§°`

#å‘½ä»¤ä¸­çš„å¼€å¤´dä»£è¡¨default è¡¨ç¤ºæ–‡ä»¶ç»§æ‰¿çš„å±æ€§

```bash
[root@CitProbe ~] ls -ld test 
drwxr-xr-x. 2 root root 6 Jul  4 15:06 test
[root@CitProbe ~] setfacl -m d:u:arc:rwx test #æ·»åŠ ACLæƒé™ é’ˆå¯¹arcç”¨æˆ·åœ¨testç›®å½•ä¸‹åˆ›å»ºçš„æ‰€æœ‰æ–‡ä»¶éƒ½ç¼ºçœå¸¦æœ‰rwxçš„ACLæƒé™
[root@CitProbe ~] ls -ld test
drwxr-xr-x+ 2 root root 6 Jul  4 15:06 test
[root@CitProbe ~] getfacl test
# file: test
# owner: root
# group: root
user::rwx
group::r-x
other::r-x
default:user::rwx
default:user:arc:rwx
default:group::r-x
default:mask::rwx
default:other::r-x
```

**ç»§æ‰¿ACLçš„æ™®é€šæ–‡ä»¶**

```bash
[arc@CitProbe test]$ touch aaa.txt
[arc@CitProbe test]$ ls -l aaa.txt 
-rw-rw-r--+ 1 arc arc 0 Jul  4 15:15 aaa.txt
[arc@CitProbe test]$ getfacl aaa.txt 
# file: aaa.txt
# owner: arc
# group: arc
user::rw-
user:arc:rwx            #effective:rw-
group::r-x              #effective:r--
mask::rw-
other::r--
```

<aside>
âš ï¸ maskè¡¨ç¤ºæœ€å¤§æƒé™ å¯¹æœ¬èº«èµ·ä½œç”¨ å³ä½¿ç»§æ‰¿äº†ä¸Šçº§ç›®å½•çš„ACLæƒé™ å®é™…æƒé™ä¹Ÿä¸ä¼šå¤§äºmaskæŒ‡å®šçš„æƒé™ å®é™…ç”Ÿæ•ˆçš„æƒé™é€šè¿‡ACLä¸­ **#effective** æ³¨é‡Šæ ‡æ˜

</aside>

<aside>
âš ï¸ ç»§æ‰¿ACLæƒé™çš„æ–‡ä»¶çš„æœ€å¤§æƒé™å—è‡ªèº«markæœ€å¤§æƒé™çš„é™åˆ¶ è‡ªèº«markæƒé™ç»§æ‰¿ä¸Šçº§ç›®å½•çš„default:markçš„æƒé™ ä½†æ˜¯æ³¨æ„ è‡ªåŠ¨ç»§æ‰¿ä¸Šçº§markçš„markæƒé™æœ€é«˜ä¸º6 ä¹Ÿå°±æ˜¯ rw- å¯è¯» å¯å†™ ä¸å¯æ‰§è¡Œ ç›®çš„æ˜¯ä¿æŠ¤æ–‡æœ¬æ–‡ä»¶

</aside>

**ä¿®æ”¹maskæƒé™**

`setfacl -m mask:æƒé™åˆ—è¡¨(rwx) æ–‡ä»¶åç§°`

<aside>
ğŸ’¡ å€¼å¾—æ³¨æ„çš„æ˜¯ å¯¹äºæ‹¥æœ‰ç»§æ‰¿å±æ€§çš„ç›®å½•æ–‡ä»¶ å‡è®¾åœ¨è¿™ç§ç›®å½•æ–‡ä»¶ä¸‹åˆ›å»ºç›®å½•æ–‡ä»¶ æ™®é€šçš„ACLå±æ€§ä¼šç»§æ‰¿çˆ¶ç›®å½•ACLæƒé™çš„defaultæƒé™ä¸”ä¸å¤§äºmarkæƒé™ æœ¬ç›®å½•çš„defaultæƒé™ä¼šç»§æ‰¿ä¸Šä¸€ç›®å½•æƒé™çš„defaultæè¿°çš„æƒé™ ä¹Ÿå°±æ˜¯é’ˆå¯¹æœ¬ç›®å½•ä¸‹åˆ›å»ºçš„æ–‡ä»¶çš„æƒé™

</aside>

<aside>
ğŸ’¡ å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ maskæƒé™ä¸ä¼šåœ¨ç”¨æˆ·è®¾ç½®ACLæƒé™åç«‹åˆ»å‡ºç° å½“ç”¨æˆ·é’ˆå¯¹æŸä¸€ç”¨æˆ·ç»„è®¾ç½®ACLæƒé™å ç›¸åº”çš„markæƒé™æ‰ä¼šå‡ºç° è¿™ä¸€è§„åˆ™åŒæ ·é€‚ç”¨äºç”¨äºç»§æ‰¿æƒé™çš„ACLæƒé™

</aside>

```bash
[arc@CitProbe ttt]$ getfacl ttt #çˆ¶ç›®å½•çš„ACL
# file: ttt
# owner: root
# group: root
user::rwx
user:arc:r-x
group::rwx
mask::rwx
other::rwx
default:user::rwx
default:user:arc:rwx
default:group::r-x
default:mask::rwx
default:other::---
[arc@CitProbe ttt]$ cd ttt/
[arc@CitProbe ttt]$ getfacl te/ #é€šè¿‡ç»§æ‰¿çš„ACL
# file: te/
# owner: root
# group: root
user::rwx
user:arc:rwx
group::r-x
mask::rwx
other::---
default:user::rwx
default:user:arc:rwx
default:group::r-x
default:mask::rwx
default:other::---
#è§‚å¯Ÿå¯è§ å­ACLçš„defaultæƒé™å®Œå…¨ç»§æ‰¿äº†çˆ¶ACLçš„default
```

---

### æƒé™å§”æ´¾ Authority delegation

**ä½¿æ™®é€šç”¨æˆ·è·å¾—ç®¡ç†å‘˜æƒé™**

ç®¡ç†æƒé™å§”æ´¾é…ç½®æ–‡ä»¶ `/etc/sudoers` 

```bash
## Sudoers allows particular users to run various commands as
## the root user, without needing the root password.
#sudoers å…è®¸ç‰¹å®šç”¨æˆ·åœ¨è¿è¡ŒæŸäº›å‘½ä»¤æ—¶è¿›è¡Œææƒ åƒrootä¸€æ · ä½†ä¸éœ€è¦rootå¯†ç 
```

```bash
arc ALL=(ALL) ALL
#arcèƒ½åœ¨ä»»ä½•åœ°æ–¹æ‰§è¡Œä»»ä½•å‘½ä»¤
%arc ALL=(ALL) ALL
#arcç»„æˆå‘˜èƒ½åœ¨ä»»ä½•åœ°æ–¹æ‰§è¡Œä»»ä½•å‘½ä»¤
arc ALL=/sbin/useradd
#é™åˆ¶arcçš„ææƒåªèƒ½è¿è¡Œuseraddå‘½ä»¤
%arc ALL=(ALL) NOPASSWD:ALL
#arcåœ¨ä»»ä½•åœ°æ–¹è¿è¡Œä»»ä½•å‘½ä»¤ä¸”ä¸éœ€è¦è¾“å…¥arcçš„å¯†ç 
```

<aside>
ğŸ’¡ æ‹¥æœ‰sudoé…ç½®æ–‡ä»¶æƒé™çš„ç”¨æˆ·å¯ä»¥ææƒ ä½†å¹¶ä¸ä»£è¡¨ç”¨æˆ·æ‹¥æœ‰äº†è¿™é¡¹æƒé™ sudoçš„æœ¬è´¨æ˜¯å§”æ´¾rootç”¨æˆ·å¸®åŠ©ææƒç”¨æˆ·å®Œæˆææƒæ“ä½œ è¿™æ˜¯sudoçš„åŸç† ä¹Ÿæ˜¯å§”æ´¾çš„ç”±æ¥

</aside>